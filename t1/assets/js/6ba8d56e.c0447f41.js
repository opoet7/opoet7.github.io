"use strict";(self.webpackChunktaymaz_docs=self.webpackChunktaymaz_docs||[]).push([[6868],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),i=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=i(e.components);return a.createElement(c.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=i(n),h=r,d=u["".concat(c,".").concat(h)]||u[h]||m[h]||l;return n?a.createElement(d,s(s({ref:t},p),{},{components:n})):a.createElement(d,s({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,s=new Array(l);s[0]=h;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[u]="string"==typeof e?e:r,s[1]=o;for(var i=2;i<l;i++)s[i]=n[i];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6672:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>i});var a=n(7462),r=(n(7294),n(3905));const l={},s="Event Query Language - EQL",o={unversionedId:"BT/EQL-SIEM",id:"BT/EQL-SIEM",title:"Event Query Language - EQL",description:"EQL",source:"@site/docs/BT/8- EQL-SIEM.md",sourceDirName:"BT",slug:"/BT/EQL-SIEM",permalink:"/t1/docs/BT/EQL-SIEM",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/BT/8- EQL-SIEM.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Sigma Rule EDR Integration",permalink:"/t1/docs/BT/Sigma Rule EDR Integration"},next:{title:"Execution",permalink:"/t1/docs/BT/Detecting Execution"}},c={},i=[{value:"EQL",id:"eql",level:2},{value:"Advantage of EQL",id:"advantage-of-eql",level:2},{value:"Event",id:"event",level:2},{value:"Event Kind",id:"event-kind",level:3},{value:"Event Category",id:"event-category",level:3},{value:"Event Type",id:"event-type",level:3},{value:"Event Outcome",id:"event-outcome",level:3},{value:"Basic EQL query",id:"basic-eql-query",level:2},{value:"Create Alert with EQL",id:"create-alert-with-eql",level:2},{value:"ELK --&gt; Detect --&gt; Rules --&gt; Create New Rule",id:"elk----detect----rules----create-new-rule",level:4}],p={toc:i},u="wrapper";function m(e){let{components:t,...l}=e;return(0,r.kt)(u,(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"event-query-language---eql"},"Event Query Language - EQL"),(0,r.kt)("h2",{id:"eql"},"EQL"),(0,r.kt)("p",null,"Event Query Language (EQL) is a query language for event-based time series\ndata, such as logs, metrics, and traces. EQL helps blueteam quickly find suspicious activity  and improve detections of attacker techniques defined in MITRE\u2019s  ATT&CKTM."),(0,r.kt)("h2",{id:"advantage-of-eql"},"Advantage of EQL"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"EQL lets you express relationships between events."),(0,r.kt)("br",{parentName:"li"}),"Many query languages allow you to match single events. EQL lets you match a\nsequence of events across different event categories and time spans."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"EQL has a low learning curve."),(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("a",{parentName:"li",href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/eql-syntax.html",title:"EQL syntax reference"},"EQL syntax")," looks like other common query languages, such as SQL.\nEQL lets you write and read queries intuitively, which makes for quick,\niterative searching."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"EQL is designed for security use cases."),(0,r.kt)("br",{parentName:"li"}),"While you can use it for any event-based data, we created EQL for threat\nhunting. EQL not only supports indicator of compromise (IOC) searches but can describe activity that goes beyond IOCs.")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(465).Z,width:"1702",height:"875"})),(0,r.kt)("h2",{id:"event"},"Event"),(0,r.kt)("h3",{id:"event-kind"},"Event Kind"),(0,r.kt)("p",null,"gives high-level information about what type of information the event  contains,without being specific to the contents of the event "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"alert"),(0,r.kt)("li",{parentName:"ul"},"enrichment"),(0,r.kt)("li",{parentName:"ul"},"event"),(0,r.kt)("li",{parentName:"ul"},"metric")),(0,r.kt)("h3",{id:"event-category"},"Event Category"),(0,r.kt)("p",null,"Indicates the second level in the ECS category hierarchy "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"process")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"network ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"file")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"registry ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"host "))),(0,r.kt)("h3",{id:"event-type"},"Event Type"),(0,r.kt)("p",null,'represents a categorization "sub-bucket" that, when used along with the ',(0,r.kt)("inlineCode",{parentName:"p"},"event.category")," field values"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"protocol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"allowed")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"connection ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"start ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"user"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"event.type:connection AND event.type:allowed")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"event.category:process AND event.type:start")),(0,r.kt)("h3",{id:"event-outcome"},"Event Outcome"),(0,r.kt)("p",null,"simply denotes whether the event represents a success or a failure from the perspective of the entity that produced the event."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.elastic.co/guide/en/ecs/8.5/ecs-allowed-values-event-outcome.html#ecs-event-outcome-failure",title:"failure"},"failure")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.elastic.co/guide/en/ecs/8.5/ecs-allowed-values-event-outcome.html#ecs-event-outcome-success",title:"success"},"success")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.elastic.co/guide/en/ecs/8.5/ecs-allowed-values-event-outcome.html#ecs-event-outcome-unknown",title:"unknown"},"unknown"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"event.category:file AND event.type:create AND event.outcome:success")),(0,r.kt)("h2",{id:"basic-eql-query"},"Basic EQL query"),(0,r.kt)("p",null,"search in process event category for specific process"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n  "query":"""\n    process where process.name == "hh.exe"\n    """\n}\n')),(0,r.kt)("p",null,"search in any event category"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n  "query":"""\n   any where network.protocol == "http"\n    """\n}\n')),(0,r.kt)("p",null,"search with not operator"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n "query": """\n        process where process.name == "cmd.exe" and process.parent.name != "explorer.exe"\n  """\n}\n')),(0,r.kt)("p",null,"search process command line not null"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sq"},'GET /*/_eql/search\n{\n  "query": """\n    process where process.name == "regsvr32.exe" and process.command_line != null\n  """\n}\n')),(0,r.kt)("p",null,"search multi process "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'GET /*/_eql/search\n{\n  "query": """\n    process where process.name in~ ("cmd.exe", "powershell.exe", "pwsh.exe")\n  """\n}\n')),(0,r.kt)("p",null,"search sequence in two event category "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /winlogbeat-8.2.0/_eql/search\n{\n "query": """\n    sequence\n      [ process where process.name == "cmd.exe" ]\n      [ file where stringContains(file.name, "bcrypt.dll") ]\n  """\n}\n')),(0,r.kt)("p",null,"matching sequence to a timespan"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n"query": """\n    sequence with maxspan=1h\n      [ process where process.name == "regsvr32.exe" ]\n      [ file where stringContains(file.name, "scrobj.dll") ]\n  """\n}\n')),(0,r.kt)("p",null,"Match events that share the same field values"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n  "query": """\n    sequence with maxspan=20h\n      [ process where process.name == "cmd.exe" ] by process.pid\n      [ file where stringContains(file.name, "test.dll") ] by process.pid\n  """\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n  "query": """\n   sequence by process.pid with maxspan=1h\n       [ process where process.name == "regsvr32.exe" ]\n       [ file where stringContains(file.name, "scrobj.dll") ]\n  """\n}\n')),(0,r.kt)("p",null,"match events with a process.args_count value of 4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n "query": """\n      process where ( 4 / process.args_count ) == 1\n  """\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /*/_eql/search\n{\n  "query": """\n  sequence by user.name with maxspan=10h\n  [file where file.extension == "dll" ]\n  [ process where true ]\n\n  """\n}\n')),(0,r.kt)("p",null,"process has network connection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'GET /winlogbeat-8.2.0/_eql/search\n{\n  "query": """\n      sequence by process.pid\n      [process where process.name == "svchost.exe"]\n      [network where true]\n  """\n}\n')),(0,r.kt)("p",null,"Event hists"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'GET /winlogbeat-8.2.0/_eql/search?filter_path=-hits.events    \n{\n  "query": """\n    any where process.name == "regsvr32.exe"                \n  """,\n  "size": 200                                             \n}\n')),(0,r.kt)("h2",{id:"create-alert-with-eql"},"Create Alert with EQL"),(0,r.kt)("h4",{id:"elk----detect----rules----create-new-rule"},"ELK --\x3e Detect --\x3e Rules --\x3e Create New Rule"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(6002).Z,width:"2094",height:"1156"})),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(1398).Z,width:"1886",height:"1100"})))}m.isMDXComponent=!0},6002:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/12-87e23be0a0860c20dd3cd3ff6e214585.png"},1398:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/13-51f1b02e50a6312e4b6571755b684537.png"},465:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/eql-whoami-00fdf41d442c9166e652b2dc81387071.jpg"}}]);